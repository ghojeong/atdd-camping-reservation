Feature: 캠핑장 예약 시스템
  고객이 캠핑 사이트를 예약하고 관리할 수 있는 시스템

  Background:
    Given 캠핑 사이트 "A001"(대형)과 "B001"(소형)이 등록되어 있다
    And 오늘 날짜는 "2024-01-15"이다

  Scenario: 정상적인 예약 생성
    Given 고객 "김철수"의 전화번호는 "010-1234-5678"이다
    When "2024-01-20"부터 "2024-01-22"까지 사이트 "A001"을 예약 요청한다
    Then 예약이 성공적으로 생성된다
    And 6자리 확인코드가 발급된다
    And 예약 상태는 "CONFIRMED"이다

  Scenario: 30일 초과 예약 시도
    Given 고객 "김철수"의 전화번호는 "010-1234-5678"이다
    When "2024-02-20"부터 "2024-02-22"까지 사이트 "A001"을 예약 요청한다
    Then 예약이 실패한다
    And "30일 이내 예약만 가능합니다" 오류 메시지를 받는다

  Scenario: 과거 날짜 예약 시도
    Given 고객 "김철수"의 전화번호는 "010-1234-5678"이다
    When "2024-01-10"부터 "2024-01-12"까지 사이트 "A001"을 예약 요청한다
    Then 예약이 실패한다
    And "과거 날짜로 예약할 수 없습니다" 오류 메시지를 받는다

  Scenario: 동시 예약 요청 시 하나만 성공
    Given 고객 "김철수"와 "이영희"가 동시에 같은 예약을 요청한다
    When "2024-01-20"부터 "2024-01-22"까지 사이트 "A001"을 동시에 예약 요청한다
    Then 하나의 예약만 성공한다
    And 나머지 예약은 "이미 예약된 기간입니다" 오류로 실패한다

  Scenario: 연박 예약 시 전체 기간 가용성 확인
    Given 사이트 "A001"의 "2024-01-21" 날짜가 이미 예약되어 있다
    When "2024-01-20"부터 "2024-01-23"까지 연박 예약을 요청한다
    Then 예약이 실패한다
    And "해당 기간에 예약이 불가능합니다" 오류 메시지를 받는다

  Scenario: 올바른 확인코드로 예약 취소
    Given 고객 "김철수"가 확인코드 "ABC123"으로 예약을 완료했다
    When 확인코드 "ABC123"으로 예약 취소를 요청한다
    Then 예약 취소가 성공한다
    And 예약 상태가 "CANCELLED"로 변경된다

  Scenario: 잘못된 확인코드로 예약 취소 시도
    Given 고객 "김철수"가 확인코드 "ABC123"으로 예약을 완료했다
    When 잘못된 확인코드 "XYZ999"로 예약 취소를 요청한다
    Then 예약 취소가 실패한다
    And "확인코드가 일치하지 않습니다" 오류 메시지를 받는다

  Scenario: 취소된 예약 사이트 재예약 가능
    Given 사이트 "A001"의 "2024-01-20" 예약이 취소된 상태이다
    When "2024-01-20"에 사이트 "A001"을 새로 예약 요청한다
    Then 예약이 성공적으로 생성된다

  Scenario: 기간별 가용 사이트 검색
    Given 사이트 "A001"은 "2024-01-20"~"2024-01-22" 기간이 예약되어 있다
    When "2024-01-20"부터 "2024-01-23"까지 가용한 사이트를 검색한다
    Then 사이트 "B001"만 검색 결과에 나타난다
    And 사이트 "A001"은 검색 결과에 나타나지 않는다

  Scenario: 사이트 크기별 필터링
    Given 대형 사이트 "A001", "A002"와 소형 사이트 "B001", "B002"가 있다
    When "2024-01-20"부터 "2024-01-22"까지 "대형" 사이트만 검색한다
    Then "A001", "A002" 사이트만 검색 결과에 나타난다

  Scenario: 이름과 전화번호로 내 예약 조회
    Given 고객 "김철수"가 전화번호 "010-1234-5678"로 여러 예약을 완료했다
    When 이름 "김철수"와 전화번호 "010-1234-5678"로 예약을 조회한다
    Then 해당 고객의 모든 예약 목록이 반환된다

  Scenario: 월별 예약 현황 캘린더 조회
    Given 사이트 "A001"에 2024년 1월 여러 예약이 있다
    When 2024년 1월 사이트 "A001"의 캘린더를 조회한다
    Then 예약된 날짜와 가능한 날짜가 구분되어 표시된다
